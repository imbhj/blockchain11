# 왜 리덕스 Thunk인가?

## 1. Redux에서 데이터 패치 문제  

Redux를 사용할 때 가장 큰 문제 중 하나는  
**"비동기 데이터 패치를 어디에서 할 것인가?"** 입니다.  

### ❌ 기존 방식의 문제점  

1. **비동기 요청이 컴포넌트 내부에 위치**  

   - `useEffect` 또는 `handleDispatch` 내부에서 `fetch` 또는 `axios` 호출  
   - 여러 컴포넌트에서 같은 API를 호출하면 **중복 코드 발생**  
   - 상태 업데이트 로직과 비동기 로직이 **혼재되어 코드가 복잡해짐**  

2. **Redux에서 비동기 처리를 직접할 수 없음** 

   - Redux의 `dispatch({ type, payload })`는 **순수한 객체(Object)만 받을 수 있음**  
   - Redux 내부에서 `fetch` 요청을 실행하려 하면, **비동기 코드가 동작하지 않음**  

3. **데이터 패치와 상태 관리가 분리되지 않음**  

   - API 호출 후 바로 Redux 상태를 업데이트해야 하는데,  
   - Redux는 **동기적(Synchronous)** 이므로 API 호출이 끝나기 전에 상태 변경이 실행될 수 있음  
   - 이런 문제를 해결하려면 **미들웨어**가 필요  

## 2. Redux Thunk란? (중간단계 적용)

### Redux의 기본 동작 방식  

Redux는 일반적으로 **객체(Object)만 dispatch 가능**합니다.  

```js
dispatch({ type: "INCREMENT" })  // ✅ 가능
dispatch({ type: "FETCH_DATA" }) // ✅ 가능
dispatch(fetchData())            // ❌ 기본 Redux에서는 불가능
```
  
Redux는 **함수(Function)를 직접 dispatch할 수 없으며**, 무조건 **객체**만 받을 수 있습니다.  

=> **즉, `dispatch(fetchData())` 같은 코드는 기본 Redux에서 동작하지 않음!**  

---

### Redux Thunk의 역할 

Redux Thunk는 **dispatch에 "함수"를 던질 수 있도록 하는 미들웨어**입니다.  

=> **Thunk = "나중에 실행될 함수"**  

기본적으로 Redux는 객체만 받지만, **Thunk 미들웨어를 추가하면 dispatch에 "함수"도 넘길 수 있음**  

## 3. Redux Thunk가 하는 일

### "dispatch에 함수를 넘길 것인가? 객체를 넘길 것인가?" 

Thunk는 **dispatch가 받는 값이 객체인지, 함수인지 구분하여 실행**합니다.  

- **객체가 들어오면:** 그대로 Redux Reducer로 전달  
- **함수가 들어오면:** 함수를 실행하고 내부에서 dispatch를 호출  

**객체를 전달하는 경우 (기본 Redux 방식)**  

```js
dispatch({ type: "INCREMENT" });  
// → Redux Reducer에서 바로 처리됨
```

**함수를 전달하는 경우 (Redux Thunk 적용)**  

```js
dispatch((dispatch) => {
    // 비동기 로직 수행 (API 호출)
    fetchData().then((data) => {
        dispatch({ type: "SETDATA", payload: data });  // → API 응답 후 Redux 상태 변경
    });
});
```
=> Thunk가 함수인지 확인하고 **dispatch를 실행해주므로 비동기 처리가 가능**해짐!

---

## 4. Redux Thunk를 사용하면 코드가 어떻게 바뀌는가?

### ❌ **Redux Thunk를 적용하지 않은 기존 방식**

```js
const fetchData = async () => {
    const { data } = await instance.get("/counter");
    // 아래는 예시임
    dispatch({ type: "SETDATA", payload: data });  // ❌ Redux에서는 dispatch를 직접 실행할 수 없음
};
```
Redux에서 dispatch는 **객체만 가능**하기 때문에 위 코드는 동작하지 않음!

---

### ✅ Redux Thunk 적용 후
```js
const fetchData = () => {
    return async (dispatch) => {
        const response = await fetch("/api/data");
        const data = await response.json();
        dispatch({ type: "SETDATA", payload: data });  // ✅ Thunk가 실행하여 Redux에 전달 가능
    };
};

```

**이제 dispatch에 `fetchData()`를 넘길 수 있음!** 

```js
dispatch(fetchData());
```

✔️ Thunk가 함수를 실행하고 내부에서 `dispatch({ type: "SETDATA" })`를 호출해줌.

## **6. Redux Thunk의 핵심 정리**
1. Redux는 기본적으로 **객체만 dispatch 가능** (`{ type: "INCREMENT" }`)  
2. Redux Thunk를 사용하면 **함수를 dispatch할 수도 있음** (`dispatch(fetchData())`)  
3. Thunk는 **함수인지 객체인지 구분하여 실행**  
4. Thunk를 사용하면 **API 요청을 Redux Action에서 수행할 수 있음**  
5. **컴포넌트는 단순히 `dispatch(fetchData())`를 실행**하면 됨 → 유지보수 용이  

## 결론: Redux Thunk를 적용하면?

- **API 호출을 Redux Action에서 수행할 수 있음**  
- **컴포넌트가 데이터를 직접 요청하지 않아도 됨**  
- **비동기 요청이 Redux 내부에서 관리되므로 코드 가독성이 향상됨**  
- **API 호출이 끝난 후 상태 업데이트가 가능해짐**  

=> **이제 Redux Thunk를 적용한 코드 작성이 가능해짐!**