## 3. EC2 인스턴스 설정

도메인과 DNS 설정이 끝났다면, 이제 실제 서비스를 띄울 서버를 구성해야 합니다.  
이 서버는 사용자가 접속하는 웹 애플리케이션이 실제로 돌아가는 공간이며, 우리가 HTTPS 인증서를 설치할 대상이기도 합니다.

우리는 AWS EC2 인스턴스를 통해 이 서버를 구성합니다.

---

### 3.1 인스턴스 구성 개요

이번 프로젝트에서는 프론트엔드와 백엔드 서버를 **서로 다른 EC2 인스턴스**에 배포합니다. 각각에 **고정된 IP(탄력 IP)** 를 할당하고, 도메인을 연결해 HTTPS를 적용할 수 있도록 구성합니다.

| 인스턴스 이름 | 역할                         | 연결 도메인                                             | 설명                                                        |
| ------------- | ---------------------------- | ------------------------------------------------------- | ----------------------------------------------------------- |
| `mve-api`     | 백엔드 API 서버              | `mve-api.store`                                         | Express 기반 서버, DB 처리, 사용자 요청 응답 등             |
| `mve-front`   | 프론트엔드 (사용자 + 관리자) | `mve-front.store`, `admin.mve-front.store` (서브도메인) | Next.js 기반 사용자 화면과 관리자 화면을 하나의 앱에서 처리 |

> `admin.mve-front.store`는 별도의 인스턴스가 아닌, 같은 프론트 앱에서 **도메인 조건에 따라 분기**합니다. 따라서 두 도메인을 모두 인증하는 하나의 HTTPS 인증서가 필요합니다.

---

### 3.2 EC2 인스턴스 생성 절차

1. AWS Console 접속 → EC2 서비스로 이동
2. 왼쪽 메뉴에서 **[인스턴스] → [인스턴스 시작]** 클릭
3. 아래 항목을 설정합니다:

| 항목          | 설정값 예시                               |
| ------------- | ----------------------------------------- |
| AMI           | Ubuntu Server 20.04 LTS (권장)            |
| 인스턴스 유형 | `t2.micro` (프리티어 대상)                |
| 키페어        | 기존 키페어 선택 or 새로 생성             |
| 네트워크      | 기본 VPC 선택, 보안 그룹은 직접 설정 예정 |
| 스토리지      | 기본값 사용 가능 (8GB 이상 추천)          |

4. 인스턴스 이름 명확히 지정:

   - 백엔드용: `mve-api`
   - 프론트엔드용: `mve-front`

5. 인스턴스 생성 후, 각 인스턴스의 **퍼블릭 IPv4 주소**를 확인
   → 이 주소는 임시이며, 다음 단계에서 **탄력 IP로 고정**합니다.

---

### 3.3 인바운드 포트 설정 (22, 80, 443)

외부에서 서버에 접속할 수 있도록 **인바운드 포트 규칙**을 설정합니다.

- **22번 포트**: SSH 접속용 (서버 직접 접속)
- **80번 포트**: HTTP 통신용 (certbot 인증서 발급 시 사용)
- **443번 포트**: HTTPS 통신용 (보안 접속)

#### 설정 방법

1. EC2 대시보드 → 인스턴스 선택 → 하단의 **보안 그룹** 클릭
2. [인바운드 규칙 편집] 클릭 → 다음 규칙 추가

| 유형  | 포트 | 소스      | 설명                                   |
| ----- | ---- | --------- | -------------------------------------- |
| SSH   | 22   | 내 IP     | 서버 접속용 (보안을 위해 IP 제한 권장) |
| HTTP  | 80   | 0.0.0.0/0 | 인증서 발급 및 HTTP 접속 허용          |
| HTTPS | 443  | 0.0.0.0/0 | 보안 접속 허용                         |

> 개발 단계에서는 모든 IP에서 접근 허용해도 되지만, **운영 환경에서는 SSH(22)는 꼭 IP 제한**을 걸어야 합니다.

---

### 3.4 탄력적 IP(Elastic IP) 생성 및 연결

EC2 인스턴스는 기본적으로 **매번 재시작 시 IP가 바뀌는 구조**입니다. 그러나 도메인을 IP에 연결하려면 **고정 IP가 반드시 필요**합니다.  
이를 위해 AWS의 탄력 IP 기능을 사용합니다.

#### 설정 절차

1. EC2 콘솔 → [네트워크 & 보안] → [탄력적 IP] 클릭
2. [탄력적 IP 주소 할당] 클릭 → 아무 설정 없이 그대로 생성
3. 생성된 IP 선택 → [작업] → [주소 연결] 클릭
4. 인스턴스 선택 → 자동으로 인터페이스 선택됨 → 연결 완료

→ `mve-api`, `mve-front` 각각에 고정된 IP를 부여해야 하므로 **탄력 IP는 2개 필요**합니다.

---

### 3.5 탄력 IP 확인 및 메모

탄력 IP를 부여한 뒤, 해당 인스턴스 상세 화면에서 **고정된 퍼블릭 IP 주소**를 확인할 수 있습니다.

- 이 IP들은 Route 53에 도메인 레코드를 등록할 때 사용됩니다.
- 예:

| 인스턴스    | 도메인                                       | 탄력 IP 예시     |
| ----------- | -------------------------------------------- | ---------------- |
| `mve-api`   | `mve-api.store`                              | `3.36.xxx.xxx`   |
| `mve-front` | `mve-front.store`<br>`admin.mve-front.store` | `15.165.xxx.xxx` |

---

이제 EC2 인스턴스를 모두 준비했습니다.
다음 단계에서는 이 IP 주소와 도메인을 연결하여 HTTPS를 설정할 준비를 합니다.

**→ 다음 파트: 4. Route 53 레코드 등록 (도메인 ↔ 서버 연결)**
