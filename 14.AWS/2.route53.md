## 2. 도메인 준비

HTTPS를 적용하려면 먼저 **도메인**이 있어야 합니다.  
도메인은 우리가 만든 웹사이트에 사람들이 접속할 수 있게 해주는 **인터넷 주소이자 이름표**입니다.  
이번 프로젝트에서는 `mve-api.store`, `mve-front.store`, `admin.mve-front.store`의 세 가지 주소를 사용하지만,  
**실제로 구매하는 도메인은 2개**이며, `admin.mve-front.store`는 **서브도메인으로 구성**합니다.  
이 도메인들을 AWS와 연결하기 위한 전체 과정을 이 절에서 설명합니다.

---

### 2.1 도메인 구매 위치: 가비아

도메인은 `gabia.com`, `cafe24.com`, `hosting.kr` 등 다양한 곳에서 구매할 수 있습니다.  
우리는 이번에 **가비아(Gabia)** 를 사용합니다.

- 예: `mve-api.store`, `mve-front.store` 등
- `.store`, `.xyz`, `.tech` 등은 `.com`보다 저렴한 경우도 많습니다.
- 도메인을 구매하면, **DNS 설정을 통해 AWS로 연결**해주는 작업이 별도로 필요합니다.

> 가비아는 도메인을 구매하는 곳일 뿐, 실제 서버나 IP 연결과는 무관합니다.
> 도메인을 구매한 뒤, AWS(Route 53)가 이 도메인의 DNS를 대신 관리할 수 있도록 **네임서버 위임 설정**을 해야 합니다.

---

### 2.2 Route 53이란 무엇인가?

구매한 도메인만 가지고는 EC2 서버와 연결되지 않습니다.  
웹에서 어떤 주소(`mve-api.store`)로 접속했을 때, 어떤 서버(IP)로 연결할지를 알려주는 것이 바로 **DNS(Domain Name System)** 입니다.  
그리고 이 DNS를 AWS에서 관리하는 서비스가 바로 **Route 53**입니다.

- Route 53은 **도메인 이름과 EC2 인스턴스 IP 주소를 연결해주는 AWS의 DNS 서비스**입니다.
- 외부에서 구매한 도메인을 Route 53에 등록해 **EC2 서버와 연결**할 수 있습니다.
- DNS 설정은 호스팅 영역과 A 레코드를 통해 구성하게 됩니다.

---

### 2.3 Route 53에 호스팅 영역 생성하기

Route 53을 사용하려면 먼저 **호스팅 영역(Hosted Zone)** 을 만들어야 합니다.  
이는 “내가 이 도메인을 AWS에서 관리하겠다”는 선언입니다.

#### 설정 흐름

1. AWS 콘솔 → **Route 53** → [호스팅 영역] 클릭
2. [호스팅 영역 생성] 클릭
3. 다음과 같이 입력:

| 항목        | 입력 예시                              |
| ----------- | -------------------------------------- |
| 도메인 이름 | `mve-api.store` 또는 `mve-front.store` |
| 유형        | 퍼블릭 호스팅 영역                     |

> 구매한 도메인 각각에 대해 호스팅 영역을 만들어야 합니다.
> 이 프로젝트에서는 **2개의 도메인을 구매**했으므로, 아래처럼 **호스팅 영역도 2개 생성**해야 합니다:
>
> - `mve-api.store`
> - `mve-front.store`
>
> 이후 **`admin.mve-front.store`는 `mve-front.store`의 서브도메인**으로 설정합니다. 별도 구매/호스팅 영역은 필요 없습니다.

---

### 2.4 NS 레코드 복사 및 가비아에 네임서버 연결하기

AWS(Route 53)에서 도메인을 관리하려면, 도메인 구매처(가비아)에  
"이 도메인의 DNS 관리를 AWS가 하게 하겠습니다"라고 알려줘야 합니다.  
이걸 **네임서버 위임**이라고 합니다.

#### 절차 요약

1. Route 53 → 생성한 호스팅 영역 → **NS 레코드 확인**

   예시:

   ```
   ns-1132.awsdns-14.org
   ns-2011.awsdns-59.co.uk
   ns-45.awsdns-07.com
   ns-1012.awsdns-11.net
   ```

2. 가비아 접속 → [내 도메인] → [네임서버 설정]

3. 입력창 8개 중 위 NS 레코드 4개만 붙여넣기

4. 저장 후 적용

> 복사할 때 **마침표(.) 포함 여부**에 주의하세요. Route 53의 복사 버튼을 쓰면 안전하게 붙여넣을 수 있습니다.

---

### 2.5 DNS 적용 대기 시간

네임서버를 변경하면 그 정보가 전 세계 DNS 서버에 퍼지는 데 시간이 걸립니다.  
이걸 **DNS 전파(DNS Propagation)** 라고 부릅니다.

- 빠르면 5분, 보통은 **30분\~2시간** 정도 소요됩니다.
- 이 시간이 지나야 도메인으로 EC2 서버에 접속할 수 있고, certbot을 통한 인증서 발급도 가능해집니다.

> DNS 전파가 끝나기 전에 certbot을 실행하면 도메인 확인 오류가 발생합니다. 반드시 충분히 기다렸다가 작업을 진행하세요.

---

### 2.6 서브도메인 전략 및 도메인 설계 원칙

이번 프로젝트에서는 하나의 프론트 서버에서 사용자와 관리자를 **도메인 기준으로 분리**합니다.  
이때 사용하는 방식이 바로 **서브도메인 전략**입니다.

#### 서브도메인 구조 요약

| 도메인                     | 설명                       | 연결 대상 인스턴스 |
| -------------------------- | -------------------------- | ------------------ |
| `mve-api.store`            | 백엔드 API 서버            | `mve-api`          |
| `mve-front.store`          | 사용자용 프론트 페이지     | `mve-front`        |
| `admin.mve-front.store` ✅ | 관리자용 서브도메인 페이지 | `mve-front`        |

> `admin.mve-front.store`는 **`mve-front.store`의 서브도메인**입니다.
> 즉, `mve-front.store`에 대한 Route 53 호스팅 영역 내에서
> **A 레코드로 `admin`을 추가**하면 자동으로 `admin.mve-front.store`가 구성됩니다.

#### 설계 원칙 요약

- **구매 도메인**: `mve-api.store`, `mve-front.store` → 총 2개
- **Route 53 호스팅 영역**: 각각 1개씩 생성 → 총 2개
- **admin 페이지는 별도 도메인 아님** → `mve-front.store`의 A 레코드(`admin`)로 구성
- 인증서 발급 시 `certbot --nginx -d mve-front.store -d admin.mve-front.store`와 같이 서브도메인 포함
- 쿠키, CORS, 권한 제어 등은 도메인 기준으로 분리 적용 가능

---

이제 도메인과 DNS 연결 준비가 완료되었습니다.
**→ 다음 파트: 3. EC2 인스턴스 설정** 으로 넘어갑니다.
