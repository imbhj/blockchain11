# JWT 생성과 검증 흐름

## 가정

    1. 유저가 로그인 함(위의 객체값을 예로 듦).
    2. 유저 값을 가지고 서명을 함.(sign함수 호출)
    3. 서명하고 난 값을 받음 => token이라고 함. => header.payload.signature

    검증할때는? 
    
    4. 해당 토큰값과, 특정 salt값을 가지고 검증을 함 => 변조되었는지, 아닌지
    5. 변조가 되지 않았다면, 검증완료(저 위의 payload를 반환받은건, 변조가 되었는지,
    되지 않았는지 확인하기 위해서 반환함)

    ....

    6. 만약 검증이 완료되지 않고, 변조가 되었다면 에러를 반환함.

## 1. 유저가 로그인

   - 예제에서는 `user` 객체(`userid`, `username` 포함)를 사용합니다.
   - 이 데이터는 JWT의 **Payload**에 담길 정보입니다.

## 2. `sign` 함수로 서명 생성

   - `sign` 함수는 다음 작업을 수행

     1. **Header 인코딩**: JWT의 암호화 방식(`HS256`)과 타입(`JWT`) 정보를 포함.
     2. **Payload 인코딩**: 유저 정보를 포함.
     3. **Signature 생성**: `header`와 `payload`를 합친 문자열을 `salt`와 함께 HMAC-SHA256 방식으로 서명.
     4. **Token 생성**: `header`, `payload`, `signature`를 `.`으로 이어붙인 JWT 생성.

   ```javascript
   const token = sign(user); // 토큰 생성
   ```

## 3. Token을 저장 또는 전달
   - `sign` 함수에서 생성된 `token`은 클라이언트에 저장되거나 API 요청 헤더에 포함되어 서버로 전달됩니다.

## 4. 서버에서 Token 검증 (`verify` 함수 호출)

   - 서버는 다음 작업을 수행

     1. **Token 분해**: 전달받은 `token`을 `.`으로 나누어 `header`, `payload`, `signature`로 분리.
     2. **새로운 Signature 생성**: 전달받은 `header`와 `payload`를 이용해 서명 생성.
     3. **검증**: 새로 생성한 서명과 전달받은 서명을 비교.  

        - 동일하면 검증 성공 → `payload` 반환.
        - 다르면 변조된 것으로 간주 → 에러 발생.

   ```javascript
   const payload = verify(token, "wnqudgus1234"); // 검증 성공 시 payload 반환
   ```

## 5. 결과 반환
   - 검증 성공: JWT의 `payload`에 포함된 데이터를 반환 → 이를 통해 사용자를 식별하거나 추가 작업 수행.
   - 검증 실패: 토큰 변조로 간주 → 에러(`"토큰이 변조됐습니다."`)를 반환.

## 핵심

1. JWT의 역할

핵심은 암호화 복호화가 단순히, 내 정보가 보이냐 안보이냐를 떠나서,  
함부로 나를 증명하여 제 3의 웹사이트를 함부로 이용하는 것을 막는 것도 있다.  
=> 데이터의 무결성(변조 여부)를 확인하는데 중점을 둠.

2. 서명(signature)의 중요성

`header`와 `payload`는 누구나 읽을 수 있지만, **서명은 데이터가 변조되지 않았음을 보장** 하는 역할  
서명 생성 시 사용하는 salt값은 외부 노출 금지.  
salt가 노출된다 => 공격자가 동일한 방식으로 서명 조작

3. 검증과정

그래서, header + "." + payload + salt값으로 다시 새롭게 서명값을 구함.  
이전의 서명값과 방금 구한 서명값과 비교.  
값이 완전히 똑같다면, 변조되지 않은걸로 판단.  
값이 다르다? 변조 되었다고 판단하고 요청 거부  
=> 즉, 값이 변조 되었냐, 되지 않았냐로 검증함.  

JWT의 검증은 데이터의 무결성을 확인하는 것